// author: runoob
jQuery(document).ready(function ($){
    searchKey = ''
    //搜索
    $(".search-reveal").click(function() {
        $(".row-search-mobile").slideToggle("400",
        function() {});
    });
    
    //代码高亮
    $('pre').each(function() {
        if(!$(this).hasClass("prettyprint")) {
            $(this).addClass("prettyprint");
        }
    });
    $(".altblock").click(function() {
        
        if($(this).find('i.fa-plus-square').length !== 0){
            $("#postcomments").show();
            $(this).find('i').removeClass("fa-plus-square").addClass("fa-minus-square");
            
        } else {
            $("#postcomments").hide();
            $(this).find('i').removeClass("fa-minus-square").addClass("fa-plus-square");
            
        }

    });
    $("#qa_headline").click(function() {$(".altblock").click()});
    // 列表
    color_flag = false; //配色标记
    prev_title_flag = false;
    next_title_flag = false;
    href = window.location.href;
    
    if($("#content img").hasClass('navup')) {
         navup_flag = false;
         $("#leftcolumn").find("a").each(function(index, value){
             if(href.indexOf($(this).prop("href")) != -1) {
                 navup_flag = true;
                 return false; 
             }
         });
        if(!navup_flag) {
            href = $(".navup").parent('a').prop("href");
        }
    }
   
    
    var total = $("#leftcolumn a").length;
     // var _atop = 0;
    $("#leftcolumn").find("a").each(function(index, value){
        
        if(next_title_flag) {
            return false; //结束循环
        } 
        
        
        cur_href = $(this).prop("href");
        cur_obj = $(this);
        // console.log(cur_href);
        //if(href.match(cur_href) != null) {
        if(href.indexOf(cur_href) != -1) {
            // _cura = $(this);
            // _atop =  $(this).offset().top;
            if(index==0) {
                $(".previous-design-link").hide();
            }
            if(index==(total-1)) {
                $(".next-design-link").hide();
            }
            
            
            if(cur_href.indexOf('/') == -1) { //第二重判断
                tmp_url = href.substring(0, href.lastIndexOf('/')+1) + cur_href;
                
                if(href != tmp_url) return;
            }
            if(!color_flag) {
                $(this).css({"background-color":"#f0893e", "color":"#fff"});
                color_flag = true;
            }
           
            //return false; 
        } else {
            
        }
    });
    
    // 侧栏
    $(".sidebar-tree > ul > li").hover(function(){
        //$(this).addClass("selected");
        $(this).children("a:eq(0)").addClass("h2-tit");
        $(this).children("ul").show();
    },function(){
        //$(this).removeClass("selected");
        $(this).children(".tit").removeClass("h2-tit");
        $(this).children("ul").hide();
    })
    
    // 首页导航
    $("#index-nav li").click(function(){
        $(this).find("a").addClass("current");
        $(this).siblings().find("a").removeClass("current");
        id = $(this).find("a").attr("data-id");
        $(".sub-navigation-articles").hide();
        if(id == 'index') {
            
        }
        
    });
    // 详情页导航
    $("#ey-detail-nav li").click(function(){
        $(this).find("a").addClass("current");
        $(this).siblings().find("a").removeClass("current");
        id = $(this).find("a").attr("data-id");
        $(".sub-navigation-articles").hide();
        if(id == 'vue') {
            $("#bootstrap").hide();
            $("#python").hide();
            $("#" + id).show();
            $(".sub-navigation-articles").show();
        } else if(id == 'python') {
            $("#bootstrap").hide();
            $("#vue").hide();
            $("#" + id).show();
            $(".sub-navigation-articles").show();
        } else if(id == 'bootstrap') {
            $("#vue").hide();
            $("#python").hide();
            $("#" + id).show();
            $(".sub-navigation-articles").show();
        } else {
            $("#bootstrap").hide();
            $("#python").hide();
            $("#vue").hide();
        }
    });


    $("#note-nav li").each(function(){
        if(window.location.pathname == $(this).find("a").attr("href")) {
            $(this).find("a").addClass("current");
            return false;
        }
      });
    $("#cate0").click(function() {
        $(".codelist-desktop").show();
        _scrollFLag = true;
        $('html,body').animate({ scrollTop: 0 }, 'fast');
        $(".home-left-column").css({"width":"16%"}); 
    })
    $(".design").click(function() {
        id = $(this).prop("id");
        $("." + id).show();
        $("." + id).siblings().hide();
        _scrollFLag = false;
        if($(".left-column").hasClass('site-fix')) {
            $(".left-column").removeClass('site-fix');
            $(".home-left-column").css({"width":"16%"}); 
            $(".middle-column-home").css({"float":""});
        
            $('html,body').animate({ scrollTop: 0 }, 'fast');
        }
    })
    //移动设备点击链接    
    $('a').on('click touchend', function(e) {
        if(screen.availHeight==548 && screen.availHeight==320) {
              var el = $(this);
              var link = el.attr('href');
              window.location = link;
          }
    });
    
    $("#pull").click(function() {
        if($(".ey-col-md2").length) {
            $(".ey-col-md2").slideToggle("400",function() {});
        } else if($(".left-column").length) {
            $(".left-column").slideToggle("400",function() {});
        }
        
    })
    $(".qrcode").hover(function(){
        $("#bottom-qrcode").show();
        },function(){
            $("#bottom-qrcode").hide();
    });
    

     // 左侧滚动部分代码
    if($("#leftcolumn").length && $(".previous-next-links").length) {
        var _dheight = $(document).height();
        var _wheight = $(window).height();
        if($(".previous-next-links:eq(1)").length) {
            var _endArticle = $(".previous-next-links:eq(1)").offset().top;
        }
        var _leftaTop = $("#leftcolumn a").last().offset().top;
        var _maxScrollTop = _dheight - $(window).height();
        var _scrollFLag = true;

        // 检测底部
        var top_of_element = $("#footer").offset().top;
        var bottom_of_element = $("#footer").offset().top + $("#footer").outerHeight();
        var bottom_of_screen = $(window).scrollTop() + $(window).innerHeight();
        var top_of_screen = $(window).scrollTop();

        if ((bottom_of_screen > top_of_element) && (top_of_screen < bottom_of_element)){
            _bottomFlag = true;
        } else {
            _bottomFlag = false;
        }
        // 检测移动设备
        if($("#pull").is(":visible")){
            _mobileFlag = true;
        } else {
            _mobileFlag = false;
        }
    } 

    if($("#main-left-cloumn").length) {
        var _scrollFLag = true;
        $(window).on('resize', function(){
            var win = $(this); //this = window
            if (win.width() <= 1025) { 
                if($(".left-column").hasClass('site-fix')) {
                    $(".left-column").removeClass('site-fix');
                    $(".home-left-column").css({"width":"16%"}); 
                    $(".middle-column-home").css({"float":""});
                }

             }
        });
    }
    //IE 、Edge浏览器 fixed 背景抖动处理
    if(navigator.userAgent.match(/Trident\/7\./)) {
        document.body.addEventListener && document.body.addEventListener("mousewheel", function(event) {
            event.preventDefault();
            var wd = event.wheelDelta;
            var csp = window.pageYOffset;
            window.scrollTo(0, csp - wd);
        });
    }
    
    $(window).scroll(function () {
        var _stop = $(window).scrollTop();
        top_of_element = $("#footer").offset().top;
        bottom_of_element = $("#footer").offset().top + $("#footer").outerHeight();
        bottom_of_screen = $(window).scrollTop() + $(window).innerHeight();
        top_of_screen = $(window).scrollTop();
        // 检测移动设备
        
        if($("#pull").is(":visible")){
            _mobileFlag = true;
        } else {
            _mobileFlag = false;
        }
        if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {
            _mobileFlag = true;
        }
         //左侧滚动部分代码
        if(( $("#leftcolumn").length || $("#main-left-cloumn").length) && !_mobileFlag) {
            
            if( $("#main-left-cloumn").length) {
                _wtop = $(".middle-column-home").offset().top + $(".middle-column-home").height(); 
            } else {
                _wtop = $(".middle-column").offset().top + $(".middle-column").height();
            }
            
            var _footerHeight = $("#footer").offset().top;
            if(_leftaTop>=_endArticle) {
                _wtop = _wtop - _stop ;
            } else if(_wheight<(_footerHeight-_stop)) {
                _wtop = _wheight;
            } else {
                _wtop = _footerHeight - _stop - 10;
            }
            
            if(_scrollFLag &&  _stop>=120 && $(window).width() > 768) {
                if($("#main-left-cloumn").length) {
                    $(".middle-column-home").css({"float":"right"});
                    //$(".home-left-column").css({"width":"14%"});  
                    
                }
                    
                if(!$(".left-column").hasClass("site-fix")) {
                        _widthFix = $(".ey-col-md2").width();
                        if($("#main-left-cloumn").length) {
                            _widthFix = $(".left-column").width();
                            
                        }
                        $(".left-column").addClass("site-fix");
                        $(".left-column").css({"width": _widthFix + "px"});
                    }
                } else if(_scrollFLag){
                    _scrollFLag = true;
                    if($(".left-column").hasClass("site-fix")) {
                        $(".left-column").removeClass("site-fix");
                        $(".left-column").css("width","");
                    }
                }
                if ((bottom_of_screen > top_of_element) && (top_of_screen < bottom_of_element)){
                    
                        _bottom = bottom_of_screen - top_of_element;
                        $(".left-column").css({"bottom": _bottom + "px"});
                } else {
                        $(".left-column").css({"bottom": ""});
                }
                
            }
        
        if(_stop>=100) {
            $(".go-top").fadeIn();
             if ($('#htmlfeedback-container').length){
                 if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {
                        
                } else {
                     $("#htmlfeedback-container").show();
                 }
             }
        }else {
            $(".go-top").fadeOut();
        }
    });


    $(".go-top").click(function(event){    
        $('html,body').animate({scrollTop:0}, 100);
        return false;
    });
    $(window).resize(function() {
        var viewportWidth = $(window).width();
        if(window.location.href.indexOf("w3cnote")!=-1) {
            //console.log('href', window.location.href);
        } else {
            if(viewportWidth>768) {
                $(".ey-col-md2").show();
            }
        }
        
    });

  
    // Bootstrap 2.x 提示
    if(window.location.href.indexOf('bootstrap-v2')!==-1) {
        var bs2_info = '<div style="color:#a94442;background-color:#f2dede;border-color:#ebccd1;padding: 15px;margin-bottom: 20px;border: 1px solid transparent;border-radius: 4px;"><strong>提示：</strong>你当前查看的是 Bootstrap 2.x 版本，<a target="_blank" href="/bootstrap/bootstrap-tutorial.html">Bootstrap3.x 版本点我</a>。</div>';
        $("#content").prepend(bs2_info);
    }
    $(".widget-header i:odd").click(function() {
        if($(this).hasClass("fa-caret-up")) {
            $(this).parent(".widget-header").siblings(".widget-content").hide();
            $(this).removeClass("fa-caret-up").addClass("fa-caret-down");
        } else {
            $(this).parent(".widget-header").siblings(".widget-content").show();
            $(this).removeClass("fa-caret-down").addClass("fa-caret-up");
        } 
    });

    // 夜间模式与日间模式
    var cateID = $("#moon").attr("data-cate");
    if(cateID) {
        var cookieMoon = readCookie("moon"+cateID);
    }
    $("#moon").click(function() {
        $(this).hide();
        $("#sun").show();
        $(".example_code").css({"background-color":"#1d1e20"});
        $(".example_code").css({"color":"#fff"});
        $(".example_result").css({"background-color":"#2e3033"});
        $(".example_result").css({"color":"#fff"});
        $("div.example").css({"background-image":"linear-gradient(#797979,#000 100px)"});
        $("div.example .showbtn").css({"background-color":"#2e3033"});
        $("div.example .tryitbtn").css({"background-color":"#2e3033"});
        $("div.code").css({"background-color":"#2e3033"});
        $("div.code").css({"color":"#fff"});
        $("h2.example").css({"color":"#fff"});
        $(".hl-main").css({"background-color":"#1d1e20"});
        $(".article").css({"background-color":"#2e3033"});
        $(".reference tr:nth-child(even)" ).css( "background-color", "#2e3033" );
        $(".simditor-wrapper" ).css( "background-color", "#2e3033" );
        $(".simditor-toolbar" ).css( "background-color", "#2e3033" );
        $(".comt-ctrl" ).css( "background-color", "#2e3033" );
        $(".ipt" ).css( "background-color", "#2e3033" );
        $(".article").css("color", "#fff");
		$(".middle-column-home").css({"background-color":"#000"});
		$(".codelist h2").css("color", "#fff");
        $("#content h1").css("color", "#fff");
		$("#content .tutintro").css("color", "#fff");
        $("#content blockquote").css("background-color", "#2e3033");
        $("#content blockquote").find("p").css("background", "#2e3033");
        $("tr").css("background-color", "#2e3033");
        $(".marked").css("background-color", "#2e3033");
        $(".comt-main").css("color", "#fff");
        $(".simditor-body p").css("color", "#fff");
        $(".simditor-toolbar").css("background-color", "#fff");
        $("#content code").css("background-color", "#2e3033");
        $(".simditor-body code").css("background-color", "#2e3033");
        $("#comment-author-info input").css("color", "#fff");
        $(".previous-next-links").css("background-color", "#2e3033");
        $("table.lamp td").css({"background-color":"#2e3033"});
        $("table.lamp th").css({"background-color":"#2e3033"});
        $("#comments h2").css({"background-color":"#2e3033"});
        $(".commentlist").find("blockquote").css({"background-color":"#000"});
        $("#comments h2").css({"color":"#fff"});
        $(".simditor-toolbar").css({"background-color":"#2e3033"});
        $(".simditor-toolbar").find("a").css({"color":"#fff"});
        $(".comt-meta").css({"background-color":"#000"});
        $("#footer .ey-block").css("background-color", "#000");

        $("div.navigation").css({"background-color":"#1f2223"});
        $("div.sidebar-box").css({"background-color":"#000"});
        $("ul.double-li").css({"background-color":"#1f2223"});
        $("div.recommend-here").css({"background-color":"#1f2223"});
        $("div.re-box").css({"background-color":"#1f2223"});
        $("div.recommend-here a").css({"background-color":"#1f2223"});
        $("div.sidebar-tree a").css({"color":"#fff"});
        $("li.selected").css({"background-color":"#000"}); 
        $("div.left-column .tab").css({"background-color":"#1f2223"});
        $("#leftcolumn a").css({"background-color":"#1f1b12"});
        $("#leftcolumn a").css({"color":"#fff"});
        $("div.sidebar-tree li").css({"background-color":"#1f1b12"});
        $("body").css({"background":"#000"});
        $("#respond .comment-signarea").css({"background-color":"#000"});
        $("div.left-column").css({"background-color": "#1d1f20", "border": "1px solid #eee"});
        $("div.search-input form").css({"background-color": "#000"});
        $("div.search-input input").css({"color": "#073642","background-color": "#a9bdbd","box-shadow": "0px 1px 5px #073642"});
        $(".hl-special").css({"color":"#9191bb"});
        $(".hl-string").css({"color":"#cdc0c0"});
        $(".hl-quotes").css({"color":"#8bc2a3"});
        $(".hl-identifier").css({"color":"#a9ccee"});
        $(".hl-number").css({"color":"#cd9ec6"});
        $(".hl-var").css({"color":"#b6b6e8"});
        $("<link/>", {
            rel: "stylesheet",
            type: "text/css",
            href: "../skin/doc/css/sons-of-obsidian.css"
         }).appendTo("head");
       
    });
    $("#sun").click(function() {
        $(this).hide();
        $("#moon").show();
        $(".example_result").css({"color":"#000"});
        $(".example_code").css({"color":"#000"});
        $(".example_code").css({"background-color":"#fff"});
        $(".hl-main").css({"background-color":"#fff"});
        $(".article").css({"background-color":"#fff"});
        $(".example_result").css({"background-color":"#fff"});
        $(".reference tr:nth-child(even)" ).css( "background-color", "#fff" );
        $(".simditor-wrapper" ).css( "background-color", "#fff" );
        $(".simditor-toolbar" ).css( "background-color", "#fff" );
        $(".comt-ctrl" ).css( "background-color", "#fbfbfb" );
        $(".ipt" ).css( "background-color", "#fff" );
        $(".article").css("color", "#000");
        $("div.code").css({"background-color":"#f6f4f0"});
        $("div.code").css({"color":"#444"});
		$(".middle-column-home").css({"background-color":"#fff"});
		$(".codelist h2").css("color", "#333");
        $("#content h1").css("color", "#000");
		$("#content .tutintro").css("color", "#333");
        $("#content blockquote").css("background-color", "#f3f7f0");
        $("#content blockquote").find("p").css("background-color", "#f3f7f0");
        $(".commentlist").find("blockquote").css({"background-color":"#f3f7f0"});
        $("tr:even").css("background-color", "#f6f4f0");
        $("tr:odd").css("background-color", "#fff");
        $(".marked").css("background-color", "#eceae6");
        $(".simditor-body p").css("color", "#333");
        $(".comt-main").css("color", "#000");
        $("#content code").css("background-color", "#eee");
        $(".simditor-body code").css("background-color", "#eee");
        $("#comment-author-info input").css("color", "#333");
        $("div.example").css({"background-image":"linear-gradient(#fff,#e5eecc 100px)"})
        $("div.example .showbtn").css({"background-color":"#ff6f06"})
        $("h2.example").css({"color":"#617f10"})
        $(".previous-next-links").css("background-color", "#fbfbfb");
        $("div.example .tryitbtn").css({"background-color":"#ff6f06"});
        $("table.lamp td").css({"background-color":"#fff"});
        $("table.lamp th").css({"background-color":"#fff"});
        $("#comments h2").css({"background-color":"#f6f5f4"});
        $("#comments h2").css({"color":"#222"});
        $(".simditor-toolbar").css({"background-color":"#fff"});
        $(".simditor-toolbar").find("a").css({"color":"#000"});
        $(".comt-meta").css({"background-color":"#ececec"});
        $("#respond .comment-signarea").css({"background-color":"#F6F6F6"});
        $("body").css({"background":"#f6f6f6"});
        $('link[href*="sons-of-obsidian.css"]').remove();
        $("#footer .ey-block").css("background-color", "#fff");
        $("div.navigation").css({"background-color":"#ff6f06"});
        $("div.sidebar-box").css({"background-color":"#fff"});
        $("ul.double-li").css({"background-color":"#f6f4f0"});
        $("div.recommend-here").css({"background-color":"#e9e9e9"});
        $("div.re-box").css({"background-color":"#fff"});
        $("div.recommend-here a").css({"background-color":"#efefef"});
        $("div.sidebar-tree a").css({"color":"#000"});
        $("div.sidebar-tree li").css({"background-color":"#f5f2ee"});
        $("div.left-column .tab").css({"background-color":"#f2f2f2"});
        $("#leftcolumn a").css({"background-color":"#f6f4f0"});
        $("#leftcolumn a").css({"color":"#000"});
        $("div.left-column").css({"background-color": "#fff", "border": "1px solid #eee"});
        $("div.search-input form").css({"background-color": "#eeefed"});
        $("div.search-input input").css({"color": "#ccc","background-color": "#fff","box-shadow": "0px 1px 5px rgb(0 0 0 / 10%)"});
        $(".hl-special").css({"color":"Navy"});
        $(".hl-string").css({"color":"#a11"});
        $(".hl-quotes").css({"color":"#8b0000"});
        $(".hl-identifier").css({"color":"#05a"});
        $(".hl-number").css({"color":"Maroon"});
        $(".hl-var").css({"color":"#cd9ec6"});
    });
  
    if(window.location.href.indexOf("python-exercise") > -1) {
        $("#respond").hide();
    }

});


function readCookie(name) {
    var nameEQ = name + "=";
    var ca = document.cookie.split(';');
    for(var i=0;i < ca.length;i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1,c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
    }
    return null;
}
